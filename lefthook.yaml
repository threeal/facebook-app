pre-commit:
  piped: true
  jobs:
    - name: install dependencies
      run: pnpm install

    - name: build shared package
      run: pnpm --filter shared exec tsc --project tsconfig.build.json

    - name: check types
      run: pnpm --recursive --filter !shared exec tsc

    - name: fix formatting
      group:
        parallel: true
        jobs:
          - name: root project
            run: pnpm prettier --write .

          - name: subprojects
            run: pnpm --recursive exec prettier --write .

    - name: fix lint
      run: pnpm --recursive exec eslint --fix

    - name: check diff
      run: git diff --exit-code pnpm-lock.yaml {staged_files}
